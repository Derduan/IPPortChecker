# 优选IP端口检测工具

## 项目简介

本项目是一个高效、健壮的IP端口检测工具，支持批量检测CSV或TXT文件中的IP和端口连通性，并根据延迟筛选最优结果。适用于代理池、反代节点、服务器可用性筛选等场景。

## 主要功能
- 支持CSV和TXT两种输入格式，自动识别。
- 支持自动检测所有国家或自定义筛选国家。
- 支持自定义输出文件编号，避免结果覆盖。
- 自动去重、自动补全端口（默认443）、自动校验IP和端口合法性。
- 检测结果按延迟排序，输出最优N个。
- 检测到本机VPN/代理环境时需用户确认。
- 依赖库自动安装，无需手动配置环境。
- 检测数量大时自动性能提示。
- 输出文件内容为空时自动警告。
- **CSV表头支持中英文及常见英文写法，自动识别，大小写和空格不敏感。**
- **TXT文件支持多种格式，国家字段支持emoji和中文。**
- **极简风格GUI，界面简洁、无自定义配色和字体，控件间距适中，体验贴近系统原生。**

## 使用方法

### 1. 运行脚本

```bash
python gui_main.py
```

### 2. 交互流程
- 选择要检测的数据文件（支持.csv/.txt）。
- 选择检测模式（全部国家或部分国家）。
- 输入要保存的最优IP数量（可留空，默认100）。
- 检测到VPN/代理环境时需输入Y确认。
- 输入输出文件编号（可留空自动生成）。

### 3. 依赖说明
- 脚本会自动安装所需依赖（pandas、requests、tqdm），无需手动操作。

## 输入文件格式说明

### CSV格式
- 必须包含“IP/国家/端口”三列，**支持中英文及常见英文表头**，如：
    - IP, IP地址, IP Address, ipaddress
    - 国家, Country, Code, 国家代码
    - 端口, Port, 端口号
- 表头自动识别，**大小写和空格不敏感**。
- 示例：

```
IP,Port,Country
1.2.3.4,443,US
5.6.7.8,8080,JP
```
或
```
IP地址,端口,国家
1.2.3.4,443,US
5.6.7.8,8080,JP
```

### TXT格式
- 每行支持以下任意格式：
    - `IP:端口#国家`  （如：1.2.3.4:443#US）
    - `IP:端口`        （如：1.2.3.4:443）
    - `IP,端口,国家`  （如：1.2.3.4,443,US）
    - `IP,端口`        （如：1.2.3.4,443）
    - `IP`            （如：1.2.3.4，端口默认为443，国家默认为UNK）
- 国家字段支持emoji和中文，如：`2.56.206.64:443#🇦🇲亚美尼亚2`
- 行首#为注释，自动跳过。
- 无法识别的行会自动跳过并提示。

## 输出说明
- 输出文件名格式：`all_top_ip_ports_编号.txt`，每行格式为：

```
IP:端口#国家
```

- 若无有效检测结果，输出文件为空并有警告提示。

## 常见问题与注意事项

- **VPN/代理检测**：如检测到本机处于VPN/代理环境，需输入Y确认，否则程序自动退出。
- **大批量检测**：如检测数量大于1000，程序会自动提示检测时间可能较长。
- **IP/端口校验**：无效IP或端口会被自动跳过并提示。
- **依赖问题**：如首次运行报依赖缺失，脚本会自动安装。
- **编码问题**：CSV自动兼容utf-8/gbk。
- **表头兼容性**：如遇非常规表头，程序会提示手动输入列名。

## 示例命令

```bash
python gui_main.py
```

---

如有更多需求或问题，欢迎反馈与交流！ 

## 打包为 .exe（适用于GUI用户）

如需将本工具打包为 Windows 下的可执行文件（.exe），可按如下步骤操作：

### 1. 安装 PyInstaller

在命令行输入（只需安装一次）：

```bash
pip install pyinstaller
```

### 2. 进入脚本所在目录

假设你的主脚本为 `优选.py`，请在命令行进入该文件所在目录。

### 3. 执行打包命令

最常用的打包命令如下：

```bash
pyinstaller --onefile --noconsole 优选.py
```

- `--onefile`：打包成单一 .exe 文件，便于分发。
- `--noconsole`：不弹出黑色命令行窗口（适用于纯 GUI 程序）。

如需打包时包含依赖文件（如 `反代ip.csv`），可加参数：

```bash
pyinstaller --onefile --noconsole --add-data "反代ip.csv;." 优选.py
```
> 注意：Windows 下分号 ;，Linux/Mac 下冒号 :

### 4. 查找生成的 .exe

打包完成后，在 `dist` 文件夹下会生成 `优选.exe`，可直接双击运行。

### 5. 常见问题

- **首次运行慢**：首次启动会解压依赖，属于正常现象。
- **杀毒误报**：部分杀毒软件可能误报，建议加白名单。
- **缺少依赖**：如有第三方库未被打包，可在脚本开头加 `import`，或用 `pip install` 安装。
- **中文路径问题**：建议将脚本和打包路径放在英文目录下，避免乱码或路径问题。

### 6. 进阶用法（可选）

- 自定义图标：
  ```bash
  pyinstaller --onefile --noconsole --icon=你的图标.ico 优选.py
  ```
- 保留命令行窗口（调试用）：去掉 `--noconsole` 参数。

如需详细打包命令或遇到具体报错，欢迎反馈！ 